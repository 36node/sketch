var Ajv = require('ajv');
var ajv = new Ajv({ logger: console, coerceTypes: true, unknownFormats: ["int32"] });

{{#withResponseStatus this}}
pm.test("Status code is {{response.status}}", function () {
  pm.response.to.have.status({{response.status}});
});
{{/withResponseStatus}}

{{#if responseSchema}}
const schema = {{{JSONstringify responseSchema}}};
pm.test("Json body schema test", function(){
  const res = {
    content: pm.response.json(),
    headers: pm.response.headers.reduce((c, k) => ({...c, [k.key]: k.value }), {})
  }
  pm.expect(ajv.validate(schema, data)).to.be.true;
})
{{/if}}